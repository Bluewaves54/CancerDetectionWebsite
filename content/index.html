<!-- Demo: https://rganesh22.github.io/htmlmockups/tensorflowjs.html -->
<!-- HTML allows us to create UI elements we can interact with-->

<head>
  <title>Skin Cancer Diagnosis</title>
  <link rel="shortcut icon" type="image/x-icon" href="https://images.squarespace-cdn.com/content/v1/5c70bcfc16b6403c514e5a3f/1574984834693-LVI3ZBLFTRFBCMFPX4YW/favicon.ico"/>

    <!-- CSS helps us design the feel and style of the UI. In this example, we're using Google's Material Design-->

    <!-- Import Google Icon Font -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Import CSS for Materialize -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

     <!--Optimize Viewport for Mobile Devices-->
     <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

</head>
<style>
  body {
    font-family: DejaVu Sans Mono, monospace;
  }
</style>
<body style="background-color:#617bc9">

    <!-- Title Bar -->
    <nav style="background-color: #091f92">
      <div class="nav-wrapper">
        <a href="#" class="brand-logo" style="font-size: 50; color: #a9dce2;">Skin Cancer Diagnosis</a>
      </div>
      <!-- <a href='#credits' style="color: #000">Credits</a> -->
    </nav>

    <!-- Contain for all other HTML Elements -->
    <div style="padding:5%;">

        <!-- Loading Bar -->
        <h6 id="loadingmodel" style="font-size: 30; color: #fff">Loading Machine Learning Model...</h6>
        <div id="progressbar" class="progress" style="background-color: #4b0082">
            <div class="indeterminate" style="background-color: #fff"></div>
        </div>

        <!-- Image File Input -->
        <div class="file-field input-field">
            <div class="waves-effect waves-light btn" style="background-color: #5884ae">
              <span style="font-size: 30; font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;">Select Image</span>
              <input type="file" accept="image/*" onchange="onFileSelected(event)">
            </div>
            <div class="file-path-wrapper">
              <input class="file-path validate" type="text">
            </div>
          </div>
        
        <!-- Image to be Classified -->
        <img id="image" width="100" height="75"></img>

        <!-- Add New Lines -->

        <br/>
        <br/>
        
        <!-- Button to Perform Classification -->
        <a
          onclick="predict()"
          class="waves-effect waves-light btn"
          style="
            font-size: 30;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            background-color: #5884ae">Classify Image</a>
        
        <!-- Text Fields for the Prediction and the Probability -->
        <h5 style='color: #fff; font-size: 30'>Prediction</h5>
        <b><p id="prediction"></p></b>
        <p id="probability"></p>

    </div>
        
    <!-- Import JS Libraries -->
    <script>
      console.log("before imports")
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
      console.log("after cloudfare import")
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
    <script>
      console.log("after tensorflow import")
    </script>
    <!-- <script src="./static/js/skin_cancer_diagnosis_script.js"></script>
    <script>
      console.log("after js script import")
    </script> -->

    <!-- Javascript allows us to apply logic to our UI elements and programmatically control the website -->
    <!-- We'll be using Tensorflow JS to perform our model inference -->

    <script>
        
        // Initialize our HTML elements as JS objects

        var imgtag = document.getElementById("image")
        var prediction_text = document.getElementById("prediction")
        var probability_text = document.getElementById("probability")

        var progressbar = document.getElementById("progressbar")
        var loadingmodel = document.getElementById("loadingmodel")

        console.log('script entered')

var model = null

var classes = ['Actinic Keratoses', 'Basal Cell Carcinoma', 'Benign Keratoses', 'Dermatofibroma', 'Melanoma', 'Melanocytic Nevus', 'Vascular Lesion']

// Function to perform prediction on our Tensorflow JS Model

async function predict() {

    try {
        if(imgtag.src == ""){
            alert("Select an Image to Classify")
            return
        }

        let tensorImg = tf.browser.fromPixels(imgtag)
                        .resizeNearestNeighbor([75, 100])
                        .toFloat().expandDims();
        
        model.predict(tensorImg).data().then(
    function (prediction){
        let predicted_class = prediction.indexOf(Math.max(...prediction))


        console.log(classes[predicted_class])
        console.log(prediction) 

        prediction_text.innerHTML = classes[predicted_class]
        probability_text.innerHTML = Math.round(prediction[predicted_class] * 100) + "% Confidence"
    }
)
        
    }catch(error){
        alert("Error Classifying Image")
    }
}

// Function to Select our Image and Display it

function onFileSelected(event) {

    try {
        var selectedFile = event.target.files[0];
        var reader = new FileReader();

        imgtag.title = selectedFile.name;

        reader.onload = function(event) {
            imgtag.src = event.target.result;
        };

        reader.readAsDataURL(selectedFile);
    }catch (error){
        alert("Error Reading Image")
    }
    
}

// Function to Select our Image and Display it


async function loadModel(){
    console.log("Loading Model")
    model = await tf.loadLayersModel('content/content/cnn_model/model.json')
    console.log("Loaded Model")

    loadingmodel.innerHTML = "Loaded Machine Learning Model"
    progressbar.style.display = "none"
}

loadModel()

    </script>
</body>